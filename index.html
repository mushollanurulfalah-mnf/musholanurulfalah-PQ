<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panitia Qurban Musholla Nurul Falah - Sistem Manajemen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
        }
        .islamic-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23065f46' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm0 0c0 11.046 8.954 20 20 20s20-8.954 20-20-8.954-20-20-20-20 8.954-20 20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal {
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 to-teal-50 islamic-pattern min-h-screen">
    <!-- Navigation -->
    <nav class="bg-emerald-800 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="text-white text-xl font-bold">
                        <i class="fas fa-mosque mr-2"></i>
                        Panitia Qurban MNF
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="userInfo" class="hidden text-white">
                        <span id="userEmail"></span>
                        <button id="logoutBtn" class="ml-4 bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">
                            <i class="fas fa-sign-out-alt mr-1"></i>Logout
                        </button>
                    </div>
                    <button id="loginBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded">
                        <i class="fas fa-sign-in-alt mr-1"></i>Login Admin
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-emerald-800 mb-2">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيم</h1>
            <h2 class="text-2xl font-semibold text-gray-700">Sistem Manajemen Qurban Musholla Nurul Falah</h2>
            <p class="text-gray-600 mt-2">Informasi dan Mengelola data panitia, hewan qurban, dan mustahik dengan mudah</p>
        </div>

        <!-- Year Selection -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-800">Dashboard Tahun</h3>
                <select id="yearSelector" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500">
                    <option value="2024">1445H / 2024</option>
                    <option value="2023">1444H / 2023</option>
                    <option value="2022">1443H / 2022</option>
                </select>
            </div>
        </div>

        <!-- Main Dashboard Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-emerald-500">
                <div class="flex items-center">
                    <div class="p-3 bg-emerald-100 rounded-full">
                        <i class="fas fa-users text-emerald-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Total Panitia</p>
                        <p id="totalPanitia" class="text-2xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div class="flex items-center">
                    <div class="p-3 bg-blue-100 rounded-full">
                        <i class="fas fa-cow text-blue-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Total Hewan</p>
                        <p id="totalHewan" class="text-2xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500">
                <div class="flex items-center">
                    <div class="p-3 bg-red-100 rounded-full">
                        <i class="fas fa-users-cog text-red-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Total Pequrban</p>
                        <p id="totalPequrban" class="text-2xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
                <div class="flex items-center">
                    <div class="p-3 bg-purple-100 rounded-full">
                        <i class="fas fa-hand-holding-heart text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Total Mustahik</p>
                        <p id="totalMustahik" class="text-2xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <!-- Hewan Statistics -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-pie text-blue-600 mr-2"></i>
                    Statistik Hewan
                </h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 flex items-center">
                            <i class="fas fa-cow text-blue-500 mr-2"></i>Sapi
                        </span>
                        <span id="totalSapi" class="font-semibold text-gray-800">0 ekor</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600 flex items-center">
                            <i class="fas fa-sheep text-green-500 mr-2"></i>Kambing
                        </span>
                        <span id="totalKambing" class="font-semibold text-gray-800">0 ekor</span>
                    </div>
                </div>
            </div>

            <!-- Mustahik per RT -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-map-marker-alt text-purple-600 mr-2"></i>
                    Mustahik per RT
                </h4>
                <div id="mustahikPerRT" class="space-y-2 max-h-40 overflow-y-auto">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Guru & Sepuh -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chalkboard-teacher text-indigo-600 mr-2"></i>
                    Guru & Sepuh
                </h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Guru</span>
                        <span id="totalGuru" class="font-semibold text-gray-800">0 orang</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Sepuh</span>
                        <span id="totalSepuh" class="font-semibold text-gray-800">0 orang</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Tokoh Masyarakat</span>
                        <span id="totalTokoh" class="font-semibold text-gray-800">0 orang</span>
                    </div>
                    <div class="border-t pt-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700 font-medium">Total</span>
                            <span id="totalGuruSepuh" class="font-bold text-indigo-600">0 orang</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-1 gap-6 mb-8">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-blue-100 text-sm">Dokumentasi</p>
                        <p id="totalFoto" class="text-2xl font-bold">0 foto</p>
                    </div>
                    <i class="fas fa-camera text-blue-200 text-3xl"></i>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8 px-6">
                    <button class="tab-btn active py-4 px-2 border-b-2 border-emerald-500 text-emerald-600 font-medium" data-tab="panitia">
                        <i class="fas fa-users mr-2"></i>Panitia
                    </button>
                    <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="hewan">
                        <i class="fas fa-cow mr-2"></i>Hewan Qurban
                    </button>
                    <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="mustahik">
                        <i class="fas fa-hand-holding-heart mr-2"></i>Mustahik
                    </button>
                    <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="guru">
                        <i class="fas fa-chalkboard-teacher mr-2"></i>Guru & Sepuh
                    </button>
                    <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="galeri">
                        <i class="fas fa-images mr-2"></i>Galeri
                    </button>
                    <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="laporan">
                        <i class="fas fa-chart-bar mr-2"></i>Laporan
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="tabContent" class="bg-white rounded-lg shadow-md p-6">
            <!-- Panitia Tab -->
            <div id="panitia-tab" class="tab-content">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Data Panitia</h3>
                    <button id="addPanitiaBtn" class="admin-only hidden bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-plus mr-2"></i>Tambah Panitia
                    </button>
                </div>
                
                <!-- Filter and Search Controls -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Tahun</label>
                            <select id="filterPanitiaTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500">
                                <option value="">Semua Tahun</option>
                                <option value="2024">1445H / 2024</option>
                                <option value="2023">1444H / 2023</option>
                                <option value="2022">1443H / 2022</option>
                                <option value="2021">1442H / 2021</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cari Nama</label>
                            <input type="text" id="searchPanitia" placeholder="Ketik nama panitia..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500">
                        </div>
                        <div class="flex items-end">
                            <button id="resetFilterPanitia" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto bg-white rounded-lg shadow border border-gray-200">
                    <table class="min-w-full table-auto border-collapse">
                        <thead class="bg-gradient-to-r from-emerald-50 to-emerald-100">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200">No</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200">Nama</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200">Jabatan</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200">No. HP</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200">Tahun</th>
                                <th class="admin-only hidden px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="panitiaTable" class="bg-white">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Hewan Qurban Tab -->
            <div id="hewan-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Data Hewan Qurban</h3>
                    <button id="addHewanBtn" class="admin-only hidden bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-plus mr-2"></i>Tambah Hewan
                    </button>
                </div>
                
                <!-- Filter and Search Controls -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Tahun</label>
                            <select id="filterHewanTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="">Semua Tahun</option>
                                <option value="2024">1445H / 2024</option>
                                <option value="2023">1444H / 2023</option>
                                <option value="2022">1443H / 2022</option>
                                <option value="2021">1442H / 2021</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Jenis</label>
                            <select id="filterHewanJenis" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="">Semua Jenis</option>
                                <option value="sapi">Sapi</option>
                                <option value="kambing">Kambing</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cari Pemilik</label>
                            <input type="text" id="searchHewan" placeholder="Ketik nama pemilik..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                        </div>
                        <div class="flex items-end">
                            <button id="resetFilterHewan" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto bg-white rounded-lg shadow border border-gray-200">
                    <table class="min-w-full table-auto border-collapse">
                        <thead class="bg-gradient-to-r from-blue-50 to-blue-100">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-r border-gray-200">No</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-r border-gray-200">Jenis</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-r border-gray-200">Nama Sapi</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-r border-gray-200">Pemilik</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-r border-gray-200">Tahun</th>
                                <th class="admin-only hidden px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border-b border-gray-200">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="hewanTable" class="bg-white">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Mustahik Tab -->
            <div id="mustahik-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Data Mustahik</h3>
                    <button id="addMustahikBtn" class="admin-only hidden bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-plus mr-2"></i>Tambah Mustahik
                    </button>
                </div>
                
                <!-- Filter and Search Controls -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Tahun</label>
                            <select id="filterMustahikTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                                <option value="">Semua Tahun</option>
                                <option value="2024">1445H / 2024</option>
                                <option value="2023">1444H / 2023</option>
                                <option value="2022">1443H / 2022</option>
                                <option value="2021">1442H / 2021</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter RT</label>
                            <select id="filterMustahikRT" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                                <option value="">Semua RT</option>
                                <option value="RT 10/04">RT 10/04</option>
                                <option value="RT 03/04">RT 03/04</option>
                                <option value="RT 04/04">RT 04/04</option>
                                <option value="RT 02/03">RT 02/03</option>
                                <option value="RT 03/03">RT 03/03</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cari Nama</label>
                            <input type="text" id="searchMustahik" placeholder="Ketik nama mustahik..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        <div class="flex items-end">
                            <button id="resetFilterMustahik" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto bg-white rounded-lg shadow border border-gray-200">
                    <table class="min-w-full table-auto border-collapse">
                        <thead class="bg-gradient-to-r from-purple-50 to-purple-100">
                            <tr>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-purple-100">No</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-purple-100">Nama Mustahik</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-purple-100">RT</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-purple-100">Tahun</th>
                                <th class="admin-only hidden px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-purple-100">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="mustahikTable" class="bg-white">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Guru & Sepuh Tab -->
            <div id="guru-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Data Guru & Sepuh</h3>
                    <button id="addGuruBtn" class="admin-only hidden bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-plus mr-2"></i>Tambah Data
                    </button>
                </div>
                
                <!-- Filter and Search Controls -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Tahun</label>
                            <select id="filterGuruTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                                <option value="">Semua Tahun</option>
                                <option value="2024">1445H / 2024</option>
                                <option value="2023">1444H / 2023</option>
                                <option value="2022">1443H / 2022</option>
                                <option value="2021">1442H / 2021</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Kategori</label>
                            <select id="filterGuruKategori" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                                <option value="">Semua Kategori</option>
                                <option value="guru">Guru</option>
                                <option value="sepuh">Sepuh</option>
                                <option value="tokoh">Tokoh Masyarakat</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cari Nama</label>
                            <input type="text" id="searchGuru" placeholder="Ketik nama..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                        </div>
                        <div class="flex items-end">
                            <button id="resetFilterGuru" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto bg-white rounded-lg shadow border border-gray-200">
                    <table class="min-w-full table-auto border-collapse">
                        <thead class="bg-gradient-to-r from-indigo-50 to-indigo-100">
                            <tr>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-indigo-100">No</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-indigo-100">Nama</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-indigo-100">Kategori</th>
                                <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-indigo-100">Tahun</th>
                                <th class="admin-only hidden px-6 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider border border-gray-300 bg-indigo-100">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="guruTable" class="bg-white">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Galeri Tab -->
            <div id="galeri-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Galeri Dokumentasi Qurban</h3>
                    <button id="addFotoBtn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-plus mr-2"></i>Upload Foto
                    </button>
                </div>
                
                <!-- Filter Controls -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter Tahun</label>
                            <select id="filterGaleriTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500">
                                <option value="">Semua Tahun</option>
                                <option value="2024">1445H / 2024</option>
                                <option value="2023">1444H / 2023</option>
                                <option value="2022">1443H / 2022</option>
                                <option value="2021">1442H / 2021</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cari Foto</label>
                            <input type="text" id="searchGaleri" placeholder="Ketik keterangan foto..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500">
                        </div>
                        <div class="flex items-end">
                            <button id="resetFilterGaleri" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Photo Count Info -->
                <div class="mb-4">
                    <p class="text-sm text-gray-600">
                        <i class="fas fa-images mr-1"></i>
                        Total: <span id="totalFotoGaleri" class="font-semibold">0</span> foto
                    </p>
                </div>
                
                <!-- Photo Grid -->
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3" id="galeriGrid">
                </div>
                
                <!-- No Photos Message -->
                <div id="noPhotosMessage" class="hidden text-center py-12">
                    <i class="fas fa-camera text-gray-300 text-6xl mb-4"></i>
                    <p class="text-gray-500 text-lg mb-2">Belum ada foto dokumentasi</p>
                    <p class="text-gray-400 text-sm">Upload foto kegiatan qurban untuk memulai galeri</p>
                </div>
            </div>

            <!-- Laporan Tab -->
            <div id="laporan-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">Laporan Data Qurban</h3>
                    <div class="flex items-center space-x-4">
                        <select id="filterLaporanTahun" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500">
                            <option value="">Semua Tahun</option>
                            <option value="2024">1445H / 2024</option>
                            <option value="2023">1444H / 2023</option>
                            <option value="2022">1443H / 2022</option>
                            <option value="2021">1442H / 2021</option>
                        </select>
                        <select id="filterLaporanJenis" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500">
                            <option value="">Laporan Lengkap</option>
                            <option value="panitia">Data Panitia</option>
                            <option value="hewan">Data Hewan</option>
                            <option value="mustahik">Data Mustahik</option>
                            <option value="guru">Data Guru & Sepuh</option>
                            <option value="sapi">Hewan Sapi Saja</option>
                            <option value="kambing">Hewan Kambing Saja</option>
                        </select>
                        <button id="exportBtn" class="admin-only hidden bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-download mr-2"></i>Export Laporan
                        </button>
                    </div>
                </div>

                <!-- Report Header -->
                <div class="bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-6 rounded-t-lg">
                    <div class="text-center">
                        <h2 class="text-2xl font-bold mb-2">LAPORAN KEGIATAN QURBAN</h2>
                        <h3 class="text-lg">MUSHOLLA NURUL FALAH (MNF)</h3>
                        <p id="laporanPeriode" class="text-emerald-100 mt-2">Periode: Semua Tahun</p>
                        <p class="text-emerald-100 text-sm">Tanggal Cetak: <span id="tanggalCetak"></span></p>
                    </div>
                </div>

                <!-- Report Content -->
                <div class="bg-white border-l border-r border-gray-200 p-6">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-4 mb-8">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-600" id="laporanTotalPanitia">0</div>
                            <div class="text-sm text-blue-600 font-medium">Total Panitia</div>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600" id="laporanTotalHewan">0</div>
                            <div class="text-sm text-green-600 font-medium">Total Hewan</div>
                        </div>
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-red-600" id="laporanTotalPequrban">0</div>
                            <div class="text-sm text-red-600 font-medium">Total Pequrban</div>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-600" id="laporanTotalSapi">0</div>
                            <div class="text-sm text-blue-600 font-medium">Total Sapi</div>
                        </div>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600" id="laporanTotalKambing">0</div>
                            <div class="text-sm text-green-600 font-medium">Total Kambing</div>
                        </div>
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-600" id="laporanTotalMustahik">0</div>
                            <div class="text-sm text-purple-600 font-medium">Total Mustahik</div>
                        </div>
                        <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-indigo-600" id="laporanTotalGuru">0</div>
                            <div class="text-sm text-indigo-600 font-medium">Guru & Sepuh</div>
                        </div>
                    </div>

                    <!-- Detailed Tables -->
                    <div class="space-y-8">
                        <!-- Hewan Qurban Table -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-cow text-blue-600 mr-2"></i>
                                Rincian Hewan Qurban
                            </h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase border border-gray-300">No</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">Jenis Hewan</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">Nama Sapi</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase border border-gray-300">Jumlah Pemilik</th>
                
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase border border-gray-300">Tahun</th>
                                        </tr>
                                    </thead>
                                    <tbody id="laporanHewanTable" class="bg-white">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Mustahik Table -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-hand-holding-heart text-purple-600 mr-2"></i>
                                Distribusi Mustahik per RT
                            </h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">RT</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase border border-gray-300">Jumlah Jiwa</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">Persentase</th>
                                        </tr>
                                    </thead>
                                    <tbody id="laporanMustahikTable" class="bg-white">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Panitia Table -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-users text-emerald-600 mr-2"></i>
                                Susunan Panitia
                            </h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">No</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">Nama</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">Jabatan</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">No. HP</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase border border-gray-300">Tahun</th>
                                        </tr>
                                    </thead>
                                    <tbody id="laporanPanitiaTable" class="bg-white">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Guru & Sepuh Table -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-chalkboard-teacher text-indigo-600 mr-2"></i>
                                Data Guru & Sepuh
                            </h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-300">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">No</th>
                                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase border border-gray-300">Nama</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase border border-gray-300">Kategori</th>
                                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase border border-gray-300">Tahun</th>
                                        </tr>
                                    </thead>
                                    <tbody id="laporanGuruTable" class="bg-white">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Report Footer -->
                <div class="bg-gray-50 border border-gray-200 rounded-b-lg p-6">
                    <div class="text-center text-sm text-gray-600">
                        <p class="mb-2">Laporan ini dibuat secara otomatis oleh Sistem Manajemen Qurban MNF</p>
                        <p>© 2025 Musholla Nurul Falah - Semua data telah diverifikasi</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-xl font-semibold text-gray-800 mb-6 text-center">Login Admin</h3>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                    <input type="email" id="loginEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                </div>
                <div class="flex justify-between">
                    <button type="button" id="cancelLogin" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Batal</button>
                    <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Modals -->
    <div id="panitiaModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 id="panitiaModalTitle" class="text-xl font-semibold text-gray-800 mb-6">Tambah Panitia</h3>
            <form id="panitiaForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Nama</label>
                    <input type="text" id="panitiaNama" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Jabatan</label>
                    <input type="text" id="panitiaJabatan" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">No. HP</label>
                    <input type="tel" id="panitiaHP" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Tahun</label>
                    <select id="panitiaTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                        <option value="2024">1445H / 2024</option>
                        <option value="2023">1444H / 2023</option>
                        <option value="2022">1443H / 2022</option>
                        <option value="2021">1442H / 2021</option>
                    </select>
                </div>
                <div class="flex justify-between">
                    <button type="button" class="cancel-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Batal</button>
                    <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="hewanModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-lg w-full mx-4 max-h-96 overflow-y-auto">
            <h3 id="hewanModalTitle" class="text-xl font-semibold text-gray-800 mb-6">Tambah Hewan Qurban</h3>
            <form id="hewanForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Jenis Hewan</label>
                    <select id="hewanJenis" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                        <option value="">Pilih Jenis</option>
                        <option value="kambing">Kambing</option>
                        <option value="sapi">Sapi</option>
                    </select>
                </div>
                <div id="sapiTypeContainer" class="mb-4 hidden">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Jenis Sapi</label>
                    <select id="sapiType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500">
                        <option value="">Pilih Sapi</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Tahun</label>
                    <select id="hewanTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                        <option value="2024">1445H / 2024</option>
                        <option value="2023">1444H / 2023</option>
                        <option value="2022">1443H / 2022</option>
                        <option value="2021">1442H / 2021</option>
                    </select>
                </div>
                <div id="pemilikContainer" class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Nama Pemilik</label>
                    <div id="pemilikList">
                        <input type="text" class="pemilik-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500 mb-2" placeholder="Nama pemilik 1" required>
                    </div>
                    <button type="button" id="addPemilik" class="text-blue-600 hover:text-blue-800 text-sm">+ Tambah Pemilik</button>
                </div>
                <div class="flex justify-between">
                    <button type="button" class="cancel-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Batal</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="mustahikModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 id="mustahikModalTitle" class="text-xl font-semibold text-gray-800 mb-6">Tambah Mustahik</h3>
            <form id="mustahikForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Nama Mustahik</label>
                    <input type="text" id="mustahikNama" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">RT</label>
                    <select id="mustahikRT" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                        <option value="">Pilih RT</option>
                        <option value="RT 10/04">RT 10/04</option>
                        <option value="RT 03/04">RT 03/04</option>
                        <option value="RT 04/04">RT 04/04</option>
                        <option value="RT 02/03">RT 02/03</option>
                        <option value="RT 03/03">RT 03/03</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Tahun</label>
                    <select id="mustahikTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                        <option value="2024">1445H / 2024</option>
                        <option value="2023">1444H / 2023</option>
                        <option value="2022">1443H / 2022</option>
                        <option value="2021">1442H / 2021</option>
                    </select>
                </div>
                <div class="flex justify-between">
                    <button type="button" class="cancel-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Batal</button>
                    <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="guruModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 id="guruModalTitle" class="text-xl font-semibold text-gray-800 mb-6">Tambah Guru/Sepuh</h3>
            <form id="guruForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Nama</label>
                    <input type="text" id="guruNama" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Kategori</label>
                    <select id="guruKategori" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500" required>
                        <option value="">Pilih Kategori</option>
                        <option value="guru">Guru</option>
                        <option value="sepuh">Sepuh</option>
                        <option value="tokoh">Tokoh Masyarakat</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Tahun</label>
                    <select id="guruTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500" required>
                        <option value="2024">1445H / 2024</option>
                        <option value="2023">1444H / 2023</option>
                        <option value="2022">1443H / 2022</option>
                        <option value="2021">1442H / 2021</option>
                    </select>
                </div>
                <div class="flex justify-between">
                    <button type="button" class="cancel-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Batal</button>
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div id="fotoModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-lg w-full mx-4 max-h-96 overflow-y-auto">
            <h3 class="text-xl font-semibold text-gray-800 mb-6">Upload Foto Kegiatan Qurban</h3>
            <form id="fotoForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Pilih Foto (Bisa Multiple)</label>
                    <input type="file" id="fotoFile" accept="image/jpeg,image/jpg,image/png,image/gif" multiple class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500" required>
                    <p class="text-xs text-gray-500 mt-1">Bisa pilih beberapa foto sekaligus. Format: JPG, JPEG, PNG, GIF (Maks 5MB per foto)</p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Tahun Kegiatan</label>
                    <select id="fotoTahun" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500" required>
                        <option value="2024">1445H / 2024</option>
                        <option value="2023">1444H / 2023</option>
                        <option value="2022">1443H / 2022</option>
                        <option value="2021">1442H / 2021</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Kategori Kegiatan</label>
                    <select id="fotoKategori" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500" required>
                        <option value="">Pilih Kategori</option>
                        <option value="persiapan">Persiapan Qurban</option>
                        <option value="penyembelihan">Penyembelihan</option>
                        <option value="pengolahan">Pengolahan Daging</option>
                        <option value="pembagian">Pembagian Daging</option>
                        <option value="panitia">Kegiatan Panitia</option>
                        <option value="lainnya">Lainnya</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Keterangan</label>
                    <textarea id="fotoKeterangan" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-500" placeholder="Deskripsi kegiatan atau keterangan foto..." required></textarea>
                </div>
                <div class="flex justify-between">
                    <button type="button" class="cancel-btn bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">Batal</button>
                    <button type="submit" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-upload mr-2"></i>Upload Foto
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Photo View Modal -->
    <div id="photoViewModal" class="fixed inset-0 bg-black bg-opacity-90 modal hidden flex items-center justify-center z-50">
        <div class="relative max-w-4xl max-h-full p-4">
            <button id="closePhotoView" class="absolute top-2 right-2 text-white hover:text-gray-300 text-2xl z-10">
                <i class="fas fa-times"></i>
            </button>
            <img id="photoViewImage" src="" alt="" class="max-w-full max-h-full object-contain rounded-lg">
            <div class="absolute bottom-4 left-4 right-4 bg-black bg-opacity-70 text-white p-4 rounded-lg">
                <h4 id="photoViewTitle" class="font-semibold mb-1"></h4>
                <p id="photoViewDescription" class="text-sm text-gray-300 mb-2"></p>
                <div class="flex items-center justify-between text-xs text-gray-400">
                    <span id="photoViewCategory"></span>
                    <span id="photoViewYear"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto mb-4"></div>
            <p class="text-gray-700">Memproses...</p>
        </div>
    </div>

    <script>
        // Firebase Configuration - Replace with your actual config
        const firebaseConfig = {
        apiKey: "AIzaSyCVQovn9-8D_Immb4nb9uafDx4bfA-q5oM",
        authDomain: "panitiaqurban-mnf.firebaseapp.com",
        projectId: "panitiaqurban-mnf",
        storageBucket: "panitiaqurban-mnf.firebasestorage.app",
        messagingSenderId: "976258695981",
        appId: "1:976258695981:web:d489100fa156439fce89a4"
        };

        // Initialize Firebase - PRODUCTION MODE
        let isDemo = false;
        let currentUser = null;
        let demoData = {
            panitia: [
                { id: '1', nama: 'Ahmad Fauzi', jabatan: 'Ketua Panitia', hp: '081234567890', tahun: '2024' },
                { id: '2', nama: 'Siti Aminah', jabatan: 'Sekretaris', hp: '081234567891', tahun: '2024' },
                { id: '3', nama: 'Muhammad Yusuf', jabatan: 'Bendahara', hp: '081234567892', tahun: '2024' },
                { id: '4', nama: 'Umar Hakim', jabatan: 'Koordinator Lapangan', hp: '081234567893', tahun: '2024' },
                { id: '5', nama: 'Hasan Abdullah', jabatan: 'Ketua Panitia', hp: '081234567894', tahun: '2023' },
                { id: '6', nama: 'Fatimah Zahra', jabatan: 'Sekretaris', hp: '081234567895', tahun: '2023' },
                { id: '7', nama: 'Ali Rahman', jabatan: 'Bendahara', hp: '081234567896', tahun: '2023' },
                { id: '8', nama: 'Khadijah Sari', jabatan: 'Koordinator Lapangan', hp: '081234567897', tahun: '2022' },
                { id: '9', nama: 'Omar Faruq', jabatan: 'Ketua Panitia', hp: '081234567898', tahun: '2022' }
            ],
            hewan: [
                { id: '1', jenis: 'sapi', sapiType: 'Sapi 1', pemilik: ['Ahmad Ali', 'Budi Santoso', 'Citra Dewi', 'Dedi Rahman', 'Eka Sari', 'Farid Hakim', 'Gina Putri'], tahun: '2024' },
                { id: '2', jenis: 'kambing', pemilik: ['Hasan Ibrahim'], tahun: '2024' },
                { id: '3', jenis: 'kambing', pemilik: ['Indira Sari'], tahun: '2024' },
                { id: '4', jenis: 'sapi', sapiType: 'Sapi 2', pemilik: ['Pak Bambang', 'Bu Ratna', 'Mas Agus', 'Mbak Sari', 'Pak Dedi', 'Bu Rina', 'Mas Joko'], tahun: '2024' },
                { id: '5', jenis: 'sapi', sapiType: 'Sapi 3', pemilik: ['Ali Rahman', 'Siti Khadijah', 'Umar Faruq', 'Aisyah Putri', 'Hamzah Malik', 'Zainab Sari', 'Yusuf Hakim'], tahun: '2024' }
            ],
            mustahik: [
                { id: '1', nama: 'Pak Sukirman', rt: 'RT 10/04', tahun: '2024' },
                { id: '2', nama: 'Bu Suminah', rt: 'RT 03/04', tahun: '2024' },
                { id: '3', nama: 'Keluarga Budi', rt: 'RT 10/04', tahun: '2024' },
                { id: '4', nama: 'Ibu Sari', rt: 'RT 04/04', tahun: '2024' },
                { id: '5', nama: 'Pak Joko', rt: 'RT 03/04', tahun: '2024' },
                { id: '6', nama: 'Bu Ani', rt: 'RT 10/04', tahun: '2024' },
                { id: '7', nama: 'Pak Ahmad', rt: 'RT 02/03', tahun: '2023' },
                { id: '8', nama: 'Bu Fatimah', rt: 'RT 03/03', tahun: '2023' },
                { id: '9', nama: 'Keluarga Hasan', rt: 'RT 04/04', tahun: '2023' },
                { id: '10', nama: 'Bu Khadijah', rt: 'RT 0/041', tahun: '2022' }
            ],
            guru: [
                { id: '1', nama: 'Ustadz Abdullah', kategori: 'guru', tahun: '2024' },
                { id: '2', nama: 'Kyai Hasan', kategori: 'sepuh', tahun: '2024' },
                { id: '3', nama: 'Pak RT Sukiman', kategori: 'tokoh', tahun: '2024' },
                { id: '4', nama: 'Ustadz Mahmud', kategori: 'guru', tahun: '2024' },
                { id: '5', nama: 'Mbah Karno', kategori: 'sepuh', tahun: '2024' },
                { id: '6', nama: 'Ustadz Ahmad', kategori: 'guru', tahun: '2023' },
                { id: '7', nama: 'Kyai Umar', kategori: 'sepuh', tahun: '2023' },
                { id: '8', nama: 'Pak RW Bambang', kategori: 'tokoh', tahun: '2023' },
                { id: '9', nama: 'Ustadz Yusuf', kategori: 'guru', tahun: '2022' }
            ],
            galeri: [
                { id: '1', url: 'https://via.placeholder.com/150x150/10b981/ffffff?text=Sapi+1', keterangan: 'Penyembelihan sapi qurban pertama', kategori: 'penyembelihan', tahun: '2024' },
                { id: '2', url: 'https://via.placeholder.com/150x150/3b82f6/ffffff?text=Bagikan', keterangan: 'Pembagian daging kepada mustahik RT 01', kategori: 'pembagian', tahun: '2024' },
                { id: '3', url: 'https://via.placeholder.com/150x150/8b5cf6/ffffff?text=Panitia', keterangan: 'Foto bersama panitia qurban 1445H', kategori: 'panitia', tahun: '2024' },
                { id: '4', url: 'https://via.placeholder.com/150x150/f59e0b/ffffff?text=Siap', keterangan: 'Persiapan alat dan tempat penyembelihan', kategori: 'persiapan', tahun: '2024' },
                { id: '5', url: 'https://via.placeholder.com/150x150/ef4444/ffffff?text=Olah', keterangan: 'Proses pengolahan dan pemotongan daging', kategori: 'pengolahan', tahun: '2024' },
                { id: '6', url: 'https://via.placeholder.com/150x150/06b6d4/ffffff?text=Kambing', keterangan: 'Penyembelihan kambing qurban', kategori: 'penyembelihan', tahun: '2024' },
                { id: '7', url: 'https://via.placeholder.com/150x150/84cc16/ffffff?text=Bagi+2', keterangan: 'Pembagian daging untuk guru dan sepuh', kategori: 'pembagian', tahun: '2024' },
                { id: '8', url: 'https://via.placeholder.com/150x150/f97316/ffffff?text=Masak', keterangan: 'Memasak gulai untuk acara bersama', kategori: 'pengolahan', tahun: '2024' },
                { id: '9', url: 'https://via.placeholder.com/150x150/a855f7/ffffff?text=2023', keterangan: 'Dokumentasi qurban tahun lalu', kategori: 'panitia', tahun: '2023' },
                { id: '10', url: 'https://via.placeholder.com/150x150/ec4899/ffffff?text=Sapi+2023', keterangan: 'Penyembelihan sapi tahun 2023', kategori: 'penyembelihan', tahun: '2023' },
                { id: '11', url: 'https://via.placeholder.com/150x150/14b8a6/ffffff?text=Bagi+2023', keterangan: 'Pembagian daging tahun 2023', kategori: 'pembagian', tahun: '2023' },
                { id: '12', url: 'https://via.placeholder.com/150x150/6366f1/ffffff?text=2022', keterangan: 'Kegiatan qurban tahun 2022', kategori: 'lainnya', tahun: '2022' }
            ]
        };

        // Initialize Firebase
        let db, auth, storage;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            if (isDemo) {
                console.log('Running in DEMO mode - Replace with actual Firebase config');
                initializeApp();
            } else {
                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                storage = firebase.storage();
                
                // Listen for auth state changes
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        currentUser = user;
                        updateUIForLoggedInUser();
                    } else {
                        currentUser = null;
                        updateUIForLoggedOutUser();
                    }
                });
                
                initializeApp();
            }
            
            // Generate real-time year options
            generateYearOptions();
        });

        function initializeApp() {
            setupEventListeners();
            loadDashboardData();
            showTab('panitia');
        }

        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.dataset.tab;
                    showTab(tab);
                });
            });

            // Login/Logout
            document.getElementById('loginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').classList.remove('hidden');
            });

            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('cancelLogin').addEventListener('click', () => {
                document.getElementById('loginModal').classList.add('hidden');
            });

            document.getElementById('loginForm').addEventListener('submit', handleLogin);

            // Add buttons
            document.getElementById('addPanitiaBtn').addEventListener('click', () => openModal('panitiaModal'));
            document.getElementById('addHewanBtn').addEventListener('click', () => openModal('hewanModal'));
            document.getElementById('addMustahikBtn').addEventListener('click', () => openModal('mustahikModal'));
            document.getElementById('addGuruBtn').addEventListener('click', () => openModal('guruModal'));
            document.getElementById('addFotoBtn').addEventListener('click', () => openModal('fotoModal'));

            // Cancel buttons
            document.querySelectorAll('.cancel-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const modal = e.target.closest('.modal');
                    modal.classList.add('hidden');
                });
            });

            // Forms
            document.getElementById('panitiaForm').addEventListener('submit', handlePanitiaSubmit);
            document.getElementById('hewanForm').addEventListener('submit', handleHewanSubmit);
            document.getElementById('mustahikForm').addEventListener('submit', handleMustahikSubmit);
            document.getElementById('guruForm').addEventListener('submit', handleGuruSubmit);
            document.getElementById('fotoForm').addEventListener('submit', handleFotoSubmit);

            // Dynamic pemilik for hewan
            document.getElementById('addPemilik').addEventListener('click', addPemilikField);
            document.getElementById('hewanJenis').addEventListener('change', updatePemilikFields);
            document.getElementById('hewanJenis').addEventListener('change', updateSapiOptions);

            // Export button
            document.getElementById('exportBtn').addEventListener('click', exportLaporan);

            // Year selector
            document.getElementById('yearSelector').addEventListener('change', loadDashboardData);

            // Panitia filters
            document.getElementById('filterPanitiaTahun').addEventListener('change', loadPanitiaData);
            document.getElementById('searchPanitia').addEventListener('input', loadPanitiaData);
            document.getElementById('resetFilterPanitia').addEventListener('click', resetPanitiaFilters);
            
            // Hewan filters
            document.getElementById('filterHewanTahun').addEventListener('change', loadHewanData);
            document.getElementById('filterHewanJenis').addEventListener('change', loadHewanData);
            document.getElementById('searchHewan').addEventListener('input', loadHewanData);
            document.getElementById('resetFilterHewan').addEventListener('click', resetHewanFilters);
            
            // Mustahik filters
            document.getElementById('filterMustahikTahun').addEventListener('change', loadMustahikData);
            document.getElementById('filterMustahikRT').addEventListener('change', loadMustahikData);
            document.getElementById('searchMustahik').addEventListener('input', loadMustahikData);
            document.getElementById('resetFilterMustahik').addEventListener('click', resetMustahikFilters);
            
            // Guru filters
            document.getElementById('filterGuruTahun').addEventListener('change', loadGuruData);
            document.getElementById('filterGuruKategori').addEventListener('change', loadGuruData);
            document.getElementById('searchGuru').addEventListener('input', loadGuruData);
            document.getElementById('resetFilterGuru').addEventListener('click', resetGuruFilters);
            
            // Galeri filters
            document.getElementById('filterGaleriTahun').addEventListener('change', loadGaleriData);
            document.getElementById('searchGaleri').addEventListener('input', loadGaleriData);
            document.getElementById('resetFilterGaleri').addEventListener('click', resetGaleriFilters);
            
            // Laporan filter
            document.getElementById('filterLaporanTahun').addEventListener('change', loadLaporanData);
            document.getElementById('filterLaporanJenis').addEventListener('change', loadLaporanData);
            
            // Photo view modal
            document.getElementById('closePhotoView').addEventListener('click', () => {
                document.getElementById('photoViewModal').classList.add('hidden');
            });
        }

        function showTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-emerald-500', 'text-emerald-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'border-emerald-500', 'text-emerald-600');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');

            // Show tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');

            // Load data for the tab
            switch(tabName) {
                case 'panitia':
                    loadPanitiaData();
                    break;
                case 'hewan':
                    loadHewanData();
                    break;
                case 'mustahik':
                    loadMustahikData();
                    break;
                case 'guru':
                    loadGuruData();
                    break;
                case 'galeri':
                    loadGaleriData();
                    break;
                case 'laporan':
                    loadLaporanData();
                    break;
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            showLoading(true);

            if (isDemo) {
                // Demo login - accept any email/password
                setTimeout(() => {
                    currentUser = { email: email };
                    updateUIForLoggedInUser();
                    document.getElementById('loginModal').classList.add('hidden');
                    showLoading(false);
                }, 1000);
            } else {
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        currentUser = userCredential.user;
                        document.getElementById('loginModal').classList.add('hidden');
                        showLoading(false);
                        // UI will be updated by onAuthStateChanged
                    })
                    .catch((error) => {
                        let errorMessage = 'Login gagal';
                        switch(error.code) {
                            case 'auth/user-not-found':
                                errorMessage = 'Email tidak terdaftar';
                                break;
                            case 'auth/wrong-password':
                                errorMessage = 'Password salah';
                                break;
                            case 'auth/invalid-email':
                                errorMessage = 'Format email tidak valid';
                                break;
                            case 'auth/too-many-requests':
                                errorMessage = 'Terlalu banyak percobaan login. Coba lagi nanti';
                                break;
                            default:
                                errorMessage = error.message;
                        }
                        alert(errorMessage);
                        showLoading(false);
                    });
            }
        }

        function logout() {
            if (isDemo) {
                currentUser = null;
                updateUIForLoggedOutUser();
            } else {
                auth.signOut().then(() => {
                    // UI will be updated by onAuthStateChanged
                }).catch((error) => {
                    console.error('Logout error:', error);
                    alert('Gagal logout: ' + error.message);
                });
            }
        }

        function updateUIForLoggedInUser() {
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userEmail').textContent = currentUser.email;
            document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.querySelectorAll('.admin-only').forEach(el => el.classList.add('hidden'));
        }

        async function loadDashboardData() {
            const selectedYear = document.getElementById('yearSelector').value;
            
            if (isDemo) {
                // Filter data by selected year
                const panitiaYear = demoData.panitia.filter(p => p.tahun === selectedYear);
                const hewanYear = demoData.hewan.filter(h => h.tahun === selectedYear);
                const mustahikYear = demoData.mustahik.filter(m => m.tahun === selectedYear);
                const guruYear = demoData.guru.filter(g => g.tahun === selectedYear);
                const galeriYear = demoData.galeri.filter(f => f.tahun === selectedYear);

                updateDashboardUI(panitiaYear, hewanYear, mustahikYear, guruYear, galeriYear);
            } else {
                try {
                    showLoading(true);
                    
                    // Create queries for each collection
                    let panitiaQuery = db.collection('panitia');
                    let hewanQuery = db.collection('hewan');
                    let mustahikQuery = db.collection('mustahik');
                    let guruQuery = db.collection('guru');
                    let galeriQuery = db.collection('galeri');
                    
                    // Apply year filter if selected
                    if (selectedYear) {
                        panitiaQuery = panitiaQuery.where('tahun', '==', selectedYear);
                        hewanQuery = hewanQuery.where('tahun', '==', selectedYear);
                        mustahikQuery = mustahikQuery.where('tahun', '==', selectedYear);
                        guruQuery = guruQuery.where('tahun', '==', selectedYear);
                        galeriQuery = galeriQuery.where('tahun', '==', selectedYear);
                    }
                    
                    // Execute all queries
                    const [panitiaSnapshot, hewanSnapshot, mustahikSnapshot, guruSnapshot, galeriSnapshot] = await Promise.all([
                        panitiaQuery.get(),
                        hewanQuery.get(),
                        mustahikQuery.get(),
                        guruQuery.get(),
                        galeriQuery.get()
                    ]);
                    
                    // Convert to arrays
                    const panitiaYear = panitiaSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const hewanYear = hewanSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const mustahikYear = mustahikSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const guruYear = guruSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    const galeriYear = galeriSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    
                    updateDashboardUI(panitiaYear, hewanYear, mustahikYear, guruYear, galeriYear);
                    showLoading(false);
                    
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    alert('Gagal memuat data dashboard: ' + error.message);
                    showLoading(false);
                }
            }
        }
        
        function updateDashboardUI(panitiaYear, hewanYear, mustahikYear, guruYear, galeriYear) {
            // Main dashboard cards
            document.getElementById('totalPanitia').textContent = panitiaYear.length;
            document.getElementById('totalHewan').textContent = hewanYear.length;
            document.getElementById('totalMustahik').textContent = mustahikYear.length;
            document.getElementById('totalFoto').textContent = galeriYear.length;

            // Calculate pequrban (total people who own animals)
            const totalPequrban = hewanYear.reduce((total, hewan) => total + (hewan.pemilik ? hewan.pemilik.length : 0), 0);
            document.getElementById('totalPequrban').textContent = totalPequrban;

            // Detailed statistics
            const sapiCount = hewanYear.filter(h => h.jenis === 'sapi').length;
            const kambingCount = hewanYear.filter(h => h.jenis === 'kambing').length;

            document.getElementById('totalSapi').textContent = `${sapiCount} ekor`;
            document.getElementById('totalKambing').textContent = `${kambingCount} ekor`;

            // Guru & Sepuh statistics
            const guruCount = guruYear.filter(g => g.kategori === 'guru').length;
            const sepuhCount = guruYear.filter(g => g.kategori === 'sepuh').length;
            const tokohCount = guruYear.filter(g => g.kategori === 'tokoh').length;

            document.getElementById('totalGuru').textContent = `${guruCount} orang`;
            document.getElementById('totalSepuh').textContent = `${sepuhCount} orang`;
            document.getElementById('totalTokoh').textContent = `${tokohCount} orang`;
            document.getElementById('totalGuruSepuh').textContent = `${guruYear.length} orang`;

            // Mustahik per RT
            const rtStats = {};
            mustahikYear.forEach(m => {
                rtStats[m.rt] = (rtStats[m.rt] || 0) + 1;
            });

            const mustahikPerRTContainer = document.getElementById('mustahikPerRT');
            mustahikPerRTContainer.innerHTML = '';
            Object.entries(rtStats).forEach(([rt, count]) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center';
                div.innerHTML = `
                    <span class="text-gray-600">${rt}</span>
                    <span class="font-semibold text-gray-800">${count} keluarga</span>
                `;
                mustahikPerRTContainer.appendChild(div);
            });
        }

        function loadPanitiaData() {
            const tbody = document.getElementById('panitiaTable');
            tbody.innerHTML = '';

            if (isDemo) {
                let filteredData = [...demoData.panitia];
                
                // Apply year filter
                const yearFilter = document.getElementById('filterPanitiaTahun').value;
                if (yearFilter) {
                    filteredData = filteredData.filter(p => p.tahun === yearFilter);
                }
                
                // Apply search filter
                const searchTerm = document.getElementById('searchPanitia').value.toLowerCase();
                if (searchTerm) {
                    filteredData = filteredData.filter(p => 
                        p.nama.toLowerCase().includes(searchTerm) ||
                        p.jabatan.toLowerCase().includes(searchTerm)
                    );
                }
                
                // Sort by year (newest first) then by name
                filteredData.sort((a, b) => {
                    if (a.tahun !== b.tahun) {
                        return b.tahun.localeCompare(a.tahun);
                    }
                    return a.nama.localeCompare(b.nama);
                });
                
                filteredData.forEach((panitia, index) => {
                    const row = createPanitiaRow(panitia, index + 1);
                    tbody.appendChild(row);
                });
                
                // Show no data message if empty
                if (filteredData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500 border-b border-gray-200">
                            <i class="fas fa-search text-3xl mb-2 block"></i>
                            Tidak ada data panitia yang ditemukan
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            }
        }

        function createPanitiaRow(panitia, nomor) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors duration-200';
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 border-b border-gray-200">${nomor}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200">${panitia.nama}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200">${panitia.jabatan}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200">${panitia.hp}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">
                        ${panitia.tahun}
                    </span>
                </td>
                <td class="admin-only hidden px-6 py-4 whitespace-nowrap text-sm font-medium border-b border-gray-200 text-center">
                    <button onclick="editPanitia('${panitia.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3 px-2 py-1 rounded hover:bg-indigo-50">
                        <i class="fas fa-edit mr-1"></i>Edit
                    </button>
                    <button onclick="deletePanitia('${panitia.id}')" class="text-red-600 hover:text-red-900 px-2 py-1 rounded hover:bg-red-50">
                        <i class="fas fa-trash mr-1"></i>Hapus
                    </button>
                </td>
            `;
            return row;
        }

        function loadHewanData() {
            const tbody = document.getElementById('hewanTable');
            tbody.innerHTML = '';

            if (isDemo) {
                let filteredData = [...demoData.hewan];
                
                // Apply year filter
                const yearFilter = document.getElementById('filterHewanTahun').value;
                if (yearFilter) {
                    filteredData = filteredData.filter(h => h.tahun === yearFilter);
                }
                
                // Apply jenis filter
                const jenisFilter = document.getElementById('filterHewanJenis').value;
                if (jenisFilter) {
                    filteredData = filteredData.filter(h => h.jenis === jenisFilter);
                }
                
                // Apply search filter
                const searchTerm = document.getElementById('searchHewan').value.toLowerCase();
                if (searchTerm) {
                    filteredData = filteredData.filter(h => 
                        h.pemilik.some(pemilik => pemilik.toLowerCase().includes(searchTerm)) ||
                        (h.sapiType && h.sapiType.toLowerCase().includes(searchTerm))
                    );
                }
                
                // Sort by year (newest first) then by jenis
                filteredData.sort((a, b) => {
                    if (a.tahun !== b.tahun) {
                        return b.tahun.localeCompare(a.tahun);
                    }
                    return a.jenis.localeCompare(b.jenis);
                });
                
                filteredData.forEach((hewan, index) => {
                    const row = createHewanRow(hewan, index + 1);
                    tbody.appendChild(row);
                });
                
                // Show no data message if empty
                if (filteredData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500 border-b border-gray-200">
                            <i class="fas fa-search text-3xl mb-2 block"></i>
                            Tidak ada data hewan yang ditemukan
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            }
        }

        function createHewanRow(hewan, nomor) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors duration-200';
            
            const sapiName = hewan.jenis === 'sapi' ? hewan.sapiType || '-' : '-';
            const pemilikList = hewan.pemilik.map((nama, index) => `${index + 1}. ${nama}`).join('<br>');
            
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 border-b border-r border-gray-200">${nomor}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-r border-gray-200 capitalize">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${hewan.jenis === 'sapi' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}">
                        <i class="fas ${hewan.jenis === 'sapi' ? 'fa-cow' : 'fa-sheep'} mr-1"></i>
                        ${hewan.jenis}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-r border-gray-200">${sapiName}</td>
                <td class="px-6 py-4 text-sm text-gray-900 border-b border-r border-gray-200" style="line-height: 1.4;">${pemilikList}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-r border-gray-200">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        ${hewan.tahun}
                    </span>
                </td>
                <td class="admin-only hidden px-6 py-4 whitespace-nowrap text-sm font-medium border-b border-gray-200 text-center">
                    <button onclick="editHewan('${hewan.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3 px-2 py-1 rounded hover:bg-indigo-50">
                        <i class="fas fa-edit mr-1"></i>Edit
                    </button>
                    <button onclick="deleteHewan('${hewan.id}')" class="text-red-600 hover:text-red-900 px-2 py-1 rounded hover:bg-red-50">
                        <i class="fas fa-trash mr-1"></i>Hapus
                    </button>
                </td>
            `;
            return row;
        }

        function loadMustahikData() {
            const tbody = document.getElementById('mustahikTable');
            tbody.innerHTML = '';

            if (isDemo) {
                let filteredData = [...demoData.mustahik];
                
                // Apply year filter
                const yearFilter = document.getElementById('filterMustahikTahun').value;
                if (yearFilter) {
                    filteredData = filteredData.filter(m => m.tahun === yearFilter);
                }
                
                // Apply RT filter
                const rtFilter = document.getElementById('filterMustahikRT').value;
                if (rtFilter) {
                    filteredData = filteredData.filter(m => m.rt === rtFilter);
                }
                
                // Apply search filter
                const searchTerm = document.getElementById('searchMustahik').value.toLowerCase();
                if (searchTerm) {
                    filteredData = filteredData.filter(m => 
                        m.nama.toLowerCase().includes(searchTerm)
                    );
                }
                
                // Sort by year (newest first) then by RT then by name
                filteredData.sort((a, b) => {
                    if (a.tahun !== b.tahun) {
                        return b.tahun.localeCompare(a.tahun);
                    }
                    if (a.rt !== b.rt) {
                        return a.rt.localeCompare(b.rt);
                    }
                    return a.nama.localeCompare(b.nama);
                });
                
                filteredData.forEach((mustahik, index) => {
                    const row = createMustahikRow(mustahik, index + 1);
                    tbody.appendChild(row);
                });
                
                // Show no data message if empty
                if (filteredData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="5" class="px-6 py-8 text-center text-gray-500 border border-gray-300">
                            <i class="fas fa-search text-3xl mb-2 block"></i>
                            Tidak ada data mustahik yang ditemukan
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            }
        }

        function createMustahikRow(mustahik, nomor) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors duration-200';
            row.innerHTML = `
                <td class="px-4 py-3 text-center text-sm font-medium text-gray-900 border border-gray-300 bg-white">${nomor}</td>
                <td class="px-6 py-3 text-left text-sm text-gray-900 border border-gray-300 bg-white">${mustahik.nama}</td>
                <td class="px-4 py-3 text-center text-sm text-gray-900 border border-gray-300 bg-white">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                        ${mustahik.rt}
                    </span>
                </td>
                <td class="px-4 py-3 text-center text-sm text-gray-900 border border-gray-300 bg-white">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        ${mustahik.tahun}
                    </span>
                </td>
                <td class="admin-only hidden px-6 py-3 text-center text-sm font-medium border border-gray-300 bg-white">
                    <button onclick="editMustahik('${mustahik.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3 px-2 py-1 rounded hover:bg-indigo-50">
                        <i class="fas fa-edit mr-1"></i>Edit
                    </button>
                    <button onclick="deleteMustahik('${mustahik.id}')" class="text-red-600 hover:text-red-900 px-2 py-1 rounded hover:bg-red-50">
                        <i class="fas fa-trash mr-1"></i>Hapus
                    </button>
                </td>
            `;
            return row;
        }

        function loadGuruData() {
            const tbody = document.getElementById('guruTable');
            tbody.innerHTML = '';

            if (isDemo) {
                let filteredData = [...demoData.guru];
                
                // Apply year filter
                const yearFilter = document.getElementById('filterGuruTahun').value;
                if (yearFilter) {
                    filteredData = filteredData.filter(g => g.tahun === yearFilter);
                }
                
                // Apply kategori filter
                const kategoriFilter = document.getElementById('filterGuruKategori').value;
                if (kategoriFilter) {
                    filteredData = filteredData.filter(g => g.kategori === kategoriFilter);
                }
                
                // Apply search filter
                const searchTerm = document.getElementById('searchGuru').value.toLowerCase();
                if (searchTerm) {
                    filteredData = filteredData.filter(g => 
                        g.nama.toLowerCase().includes(searchTerm)
                    );
                }
                
                // Sort by year (newest first) then by kategori then by name
                filteredData.sort((a, b) => {
                    if (a.tahun !== b.tahun) {
                        return b.tahun.localeCompare(a.tahun);
                    }
                    if (a.kategori !== b.kategori) {
                        return a.kategori.localeCompare(b.kategori);
                    }
                    return a.nama.localeCompare(b.nama);
                });
                
                filteredData.forEach((guru, index) => {
                    const row = createGuruRow(guru, index + 1);
                    tbody.appendChild(row);
                });
                
                // Show no data message if empty
                if (filteredData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td colspan="5" class="px-6 py-8 text-center text-gray-500 border border-gray-300">
                            <i class="fas fa-search text-3xl mb-2 block"></i>
                            Tidak ada data guru/sepuh yang ditemukan
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            }
        }

        function createGuruRow(guru, nomor) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition-colors duration-200';
            row.innerHTML = `
                <td class="px-4 py-3 text-center text-sm font-medium text-gray-900 border border-gray-300 bg-white">${nomor}</td>
                <td class="px-6 py-3 text-left text-sm text-gray-900 border border-gray-300 bg-white">${guru.nama}</td>
                <td class="px-4 py-3 text-center text-sm text-gray-900 border border-gray-300 bg-white">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 capitalize">
                        ${guru.kategori}
                    </span>
                </td>
                <td class="px-4 py-3 text-center text-sm text-gray-900 border border-gray-300 bg-white">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        ${guru.tahun}
                    </span>
                </td>
                <td class="admin-only hidden px-6 py-3 text-center text-sm font-medium border border-gray-300 bg-white">
                    <button onclick="editGuru('${guru.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3 px-2 py-1 rounded hover:bg-indigo-50">
                        <i class="fas fa-edit mr-1"></i>Edit
                    </button>
                    <button onclick="deleteGuru('${guru.id}')" class="text-red-600 hover:text-red-900 px-2 py-1 rounded hover:bg-red-50">
                        <i class="fas fa-trash mr-1"></i>Hapus
                    </button>
                </td>
            `;
            return row;
        }

        function loadGaleriData() {
            const grid = document.getElementById('galeriGrid');
            const noPhotosMessage = document.getElementById('noPhotosMessage');
            const totalFotoElement = document.getElementById('totalFotoGaleri');
            grid.innerHTML = '';

            if (isDemo) {
                let filteredData = [...demoData.galeri];
                
                // Apply year filter
                const yearFilter = document.getElementById('filterGaleriTahun').value;
                if (yearFilter) {
                    filteredData = filteredData.filter(f => f.tahun === yearFilter);
                }
                
                // Apply search filter
                const searchTerm = document.getElementById('searchGaleri').value.toLowerCase();
                if (searchTerm) {
                    filteredData = filteredData.filter(f => 
                        f.keterangan.toLowerCase().includes(searchTerm) ||
                        f.kategori.toLowerCase().includes(searchTerm)
                    );
                }
                
                // Sort by year (newest first) then by category
                filteredData.sort((a, b) => {
                    if (a.tahun !== b.tahun) {
                        return b.tahun.localeCompare(a.tahun);
                    }
                    return a.kategori.localeCompare(b.kategori);
                });
                
                // Update total count
                totalFotoElement.textContent = filteredData.length;
                
                if (filteredData.length === 0) {
                    noPhotosMessage.classList.remove('hidden');
                    grid.classList.add('hidden');
                } else {
                    noPhotosMessage.classList.add('hidden');
                    grid.classList.remove('hidden');
                    
                    filteredData.forEach(foto => {
                        const card = createFotoCard(foto);
                        grid.appendChild(card);
                    });
                }
            }
        }

        function createFotoCard(foto) {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-lg shadow-md overflow-hidden cursor-pointer hover:shadow-lg transition-shadow duration-200 group';
            
            // Get category color
            const categoryColors = {
                'persiapan': 'bg-yellow-100 text-yellow-800',
                'penyembelihan': 'bg-red-100 text-red-800',
                'pengolahan': 'bg-orange-100 text-orange-800',
                'pembagian': 'bg-green-100 text-green-800',
                'panitia': 'bg-blue-100 text-blue-800',
                'lainnya': 'bg-gray-100 text-gray-800'
            };
            
            const categoryColor = categoryColors[foto.kategori] || 'bg-gray-100 text-gray-800';
            
            div.innerHTML = `
                <div class="relative">
                    <img src="${foto.url}" alt="${foto.keterangan}" class="w-full h-24 sm:h-28 object-cover group-hover:scale-105 transition-transform duration-200" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik03NSA0NUMzNy41IDQ1IDQ1IDc1IDc1IDc1QzEwNSA3NSAxMTIuNSA0NSA3NSA0NVoiIGZpbGw9IiM5Q0EzQUYiLz4KPHN2ZyBpZD0iY2FtZXJhIiB3aWR0aD0iMzAiIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSI2MCIgeT0iNjAiPgo8cGF0aCBkPSJNMTIgMTVDMTMuNjU2OSAxNSAxNSAxMy42NTY5IDE1IDEyQzE1IDEwLjM0MzEgMTMuNjU2OSA5IDEyIDlDMTAuMzQzMSA5IDkgMTAuMzQzMSA5IDEyQzkgMTMuNjU2OSAxMC4zNDMxIDE1IDEyIDE1WiIgZmlsbD0iIzlDQTNBRiIvPgo8cGF0aCBkPSJNMyA3VjE3QzMgMTguMTA0NiAzLjg5NTQzIDE5IDUgMTlIMTlDMjAuMTA0NiAxOSAyMSAxOC4xMDQ2IDIxIDE3VjdDMjEgNS44OTU0MyAyMC4xMDQ2IDUgMTkgNUgxNkwxNSAzSDlMOCA1SDVDNC44OTU0MyA1IDQgNS44OTU0MyA0IDdIMTlWMTdINVY3SDNaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo8L3N2Zz4='; this.alt='Foto tidak dapat dimuat';">
                    <div class="absolute top-1 right-1 flex space-x-1">
                        <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-black bg-opacity-70 text-white">
                            ${foto.tahun}
                        </span>
                        <button onclick="deleteFoto('${foto.id}')" class="admin-only ${currentUser ? '' : 'hidden'} bg-red-600 hover:bg-red-700 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="absolute bottom-1 left-1">
                        <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${categoryColor}">
                            ${foto.kategori}
                        </span>
                    </div>
                </div>
                <div class="p-2">
                    <p class="text-xs text-gray-700 line-clamp-2 leading-tight">${foto.keterangan}</p>
                </div>
            `;
            
            // Add click event to view photo
            div.addEventListener('click', () => viewPhoto(foto));
            
            return div;
        }

        function loadLaporanData() {
            if (isDemo) {
                const yearFilter = document.getElementById('filterLaporanTahun').value;
                const jenisFilter = document.getElementById('filterLaporanJenis').value;
                
                // Filter data by year
                let filteredPanitia = yearFilter ? demoData.panitia.filter(p => p.tahun === yearFilter) : demoData.panitia;
                let filteredHewan = yearFilter ? demoData.hewan.filter(h => h.tahun === yearFilter) : demoData.hewan;
                let filteredMustahik = yearFilter ? demoData.mustahik.filter(m => m.tahun === yearFilter) : demoData.mustahik;
                let filteredGuru = yearFilter ? demoData.guru.filter(g => g.tahun === yearFilter) : demoData.guru;
                
                // Filter hewan by jenis if specified (for animal-specific filters)
                if (jenisFilter === 'sapi' || jenisFilter === 'kambing') {
                    filteredHewan = filteredHewan.filter(h => h.jenis === jenisFilter);
                }
                
                // Calculate statistics
                const totalSapi = filteredHewan.filter(h => h.jenis === 'sapi').length;
                const totalKambing = filteredHewan.filter(h => h.jenis === 'kambing').length;
                const totalPequrban = filteredHewan.reduce((total, hewan) => total + hewan.pemilik.length, 0);
                
                // Update report header based on filter type
                let periode = yearFilter ? `Tahun ${yearFilter}` : 'Semua Tahun';
                let reportTitle = 'LAPORAN KEGIATAN QURBAN';
                
                if (jenisFilter) {
                    switch(jenisFilter) {
                        case 'panitia':
                            reportTitle = 'LAPORAN DATA PANITIA';
                            periode += ' - Data Panitia';
                            break;
                        case 'hewan':
                            reportTitle = 'LAPORAN DATA HEWAN QURBAN';
                            periode += ' - Data Hewan';
                            break;
                        case 'mustahik':
                            reportTitle = 'LAPORAN DATA MUSTAHIK';
                            periode += ' - Data Mustahik';
                            break;
                        case 'guru':
                            reportTitle = 'LAPORAN DATA GURU & SEPUH';
                            periode += ' - Data Guru & Sepuh';
                            break;
                        case 'sapi':
                            reportTitle = 'LAPORAN HEWAN SAPI';
                            periode += ' - Sapi Saja';
                            break;
                        case 'kambing':
                            reportTitle = 'LAPORAN HEWAN KAMBING';
                            periode += ' - Kambing Saja';
                            break;
                    }
                }
                
                document.querySelector('.bg-gradient-to-r h2').textContent = reportTitle;
                document.getElementById('laporanPeriode').textContent = `Periode: ${periode}`;
                document.getElementById('tanggalCetak').textContent = new Date().toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Update summary cards
                document.getElementById('laporanTotalPanitia').textContent = filteredPanitia.length;
                document.getElementById('laporanTotalHewan').textContent = filteredHewan.length;
                document.getElementById('laporanTotalPequrban').textContent = totalPequrban;
                document.getElementById('laporanTotalSapi').textContent = totalSapi;
                document.getElementById('laporanTotalKambing').textContent = totalKambing;
                document.getElementById('laporanTotalMustahik').textContent = filteredMustahik.length;
                document.getElementById('laporanTotalGuru').textContent = filteredGuru.length;
                
                // Show/hide sections based on filter
                showReportSections(jenisFilter);
                
                // Load detailed tables
                loadLaporanHewanTable(filteredHewan);
                loadLaporanMustahikTable(filteredMustahik);
                loadLaporanPanitiaTable(filteredPanitia);
                loadLaporanGuruTable(filteredGuru);
            }
        }
        
        function showReportSections(jenisFilter) {
            const sections = document.querySelectorAll('#laporan-tab .space-y-8 > div');
            
            if (!jenisFilter) {
                // Show all sections for complete report
                sections.forEach(section => section.style.display = 'block');
            } else {
                // Hide all sections first
                sections.forEach(section => section.style.display = 'none');
                
                // Show specific section based on filter
                switch(jenisFilter) {
                    case 'panitia':
                        sections[2]?.style.setProperty('display', 'block'); // Panitia table (index 2)
                        break;
                    case 'hewan':
                    case 'sapi':
                    case 'kambing':
                        sections[0]?.style.setProperty('display', 'block'); // Hewan table (index 0)
                        break;
                    case 'mustahik':
                        sections[1]?.style.setProperty('display', 'block'); // Mustahik table (index 1)
                        break;
                    case 'guru':
                        sections[3]?.style.setProperty('display', 'block'); // Guru table (index 3)
                        break;
                }
            }
        }

        function loadLaporanHewanTable(hewanData) {
            const tbody = document.getElementById('laporanHewanTable');
            tbody.innerHTML = '';
            
            hewanData.forEach((hewan, index) => {
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center">${index + 1}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 capitalize">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${hewan.jenis === 'sapi' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}">
                            <i class="fas ${hewan.jenis === 'sapi' ? 'fa-cow' : 'fa-sheep'} mr-1"></i>
                            ${hewan.jenis}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm border border-gray-300">${hewan.sapiType || '-'}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center font-medium">${hewan.pemilik.length} orang</td>

                    <td class="px-4 py-3 text-sm border border-gray-300 text-center">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                            ${hewan.tahun}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Add total row if there's data
            if (hewanData.length > 0) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'bg-gray-100 font-semibold';
                totalRow.innerHTML = `
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center font-bold" colspan="4">TOTAL HEWAN</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center font-bold text-blue-700">${hewanData.length} ekor</td>
                `;
                tbody.appendChild(totalRow);
            }
        }

        function loadLaporanMustahikTable(mustahikData) {
            const tbody = document.getElementById('laporanMustahikTable');
            tbody.innerHTML = '';
            
            // Group by RT
            const rtStats = {};
            mustahikData.forEach(m => {
                rtStats[m.rt] = (rtStats[m.rt] || 0) + 1;
            });
            
            const totalMustahik = mustahikData.length;
            
            Object.entries(rtStats).sort().forEach(([rt, count]) => {
                const percentage = totalMustahik > 0 ? ((count / totalMustahik) * 100).toFixed(1) : 0;
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm border border-gray-300">${rt}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center font-medium">${count} keluarga</td>
                    <td class="px-4 py-3 text-sm border border-gray-300">${percentage}%</td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadLaporanPanitiaTable(panitiaData) {
            const tbody = document.getElementById('laporanPanitiaTable');
            tbody.innerHTML = '';
            
            panitiaData.forEach((panitia, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm border border-gray-300">${index + 1}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300">${panitia.nama}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300">${panitia.jabatan}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300">${panitia.hp}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center">${panitia.tahun}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadLaporanGuruTable(guruData) {
            const tbody = document.getElementById('laporanGuruTable');
            tbody.innerHTML = '';
            
            guruData.forEach((guru, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm border border-gray-300">${index + 1}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300">${guru.nama}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center capitalize">${guru.kategori}</td>
                    <td class="px-4 py-3 text-sm border border-gray-300 text-center">${guru.tahun}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function openModal(modalId, data = null) {
            document.getElementById(modalId).classList.remove('hidden');
            
            if (data) {
                // Fill form with existing data for editing
                fillFormWithData(modalId, data);
            } else {
                // Clear form for new entry
                clearForm(modalId);
            }
        }

        async function handlePanitiaSubmit(e) {
            e.preventDefault();
            const formData = {
                nama: document.getElementById('panitiaNama').value,
                jabatan: document.getElementById('panitiaJabatan').value,
                hp: document.getElementById('panitiaHP').value,
                tahun: document.getElementById('panitiaTahun').value,
                createdAt: new Date(),
                createdBy: currentUser ? currentUser.email : 'demo'
            };

            if (isDemo) {
                const id = Date.now().toString();
                demoData.panitia.push({ id, ...formData });
                loadPanitiaData();
                loadDashboardData();
            } else {
                try {
                    showLoading(true);
                    await db.collection('panitia').add(formData);
                    loadPanitiaData();
                    loadDashboardData();
                    showLoading(false);
                    alert('Data panitia berhasil disimpan!');
                } catch (error) {
                    console.error('Error adding panitia:', error);
                    alert('Gagal menyimpan data panitia: ' + error.message);
                    showLoading(false);
                }
            }

            document.getElementById('panitiaModal').classList.add('hidden');
        }

        function handleHewanSubmit(e) {
            e.preventDefault();
            const jenis = document.getElementById('hewanJenis').value;
            const tahun = document.getElementById('hewanTahun').value;
            const pemilikInputs = document.querySelectorAll('.pemilik-input');
            const pemilik = Array.from(pemilikInputs).map(input => input.value).filter(val => val.trim());

            const formData = { jenis, pemilik, tahun };
            
            if (jenis === 'sapi') {
                formData.sapiType = document.getElementById('sapiType').value;
            }

            if (isDemo) {
                const id = Date.now().toString();
                demoData.hewan.push({ id, ...formData });
                loadHewanData();
                loadDashboardData();
            }

            document.getElementById('hewanModal').classList.add('hidden');
        }

        function handleMustahikSubmit(e) {
            e.preventDefault();
            const formData = {
                nama: document.getElementById('mustahikNama').value,
                rt: document.getElementById('mustahikRT').value,
                tahun: document.getElementById('mustahikTahun').value
            };

            if (isDemo) {
                const id = Date.now().toString();
                demoData.mustahik.push({ id, ...formData });
                loadMustahikData();
                loadDashboardData();
            }

            document.getElementById('mustahikModal').classList.add('hidden');
        }

        function handleGuruSubmit(e) {
            e.preventDefault();
            const formData = {
                nama: document.getElementById('guruNama').value,
                kategori: document.getElementById('guruKategori').value,
                tahun: document.getElementById('guruTahun').value
            };

            if (isDemo) {
                const id = Date.now().toString();
                demoData.guru.push({ id, ...formData });
                loadGuruData();
                loadDashboardData();
            }

            document.getElementById('guruModal').classList.add('hidden');
        }

        function handleFotoSubmit(e) {
            e.preventDefault();
            const files = document.getElementById('fotoFile').files;
            const tahun = document.getElementById('fotoTahun').value;
            const kategori = document.getElementById('fotoKategori').value;
            const keterangan = document.getElementById('fotoKeterangan').value;

            // Validate files
            const maxSize = 5 * 1024 * 1024; // 5MB
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            
            for (let file of files) {
                if (file.size > maxSize) {
                    alert(`File ${file.name} terlalu besar. Maksimal 5MB per foto.`);
                    return;
                }
                if (!allowedTypes.includes(file.type)) {
                    alert(`File ${file.name} format tidak didukung. Gunakan JPG, JPEG, PNG, atau GIF.`);
                    return;
                }
            }

            if (isDemo) {
                showLoading(true);
                
                // Simulate multiple file upload
                setTimeout(() => {
                    Array.from(files).forEach((file, index) => {
                        const id = (Date.now() + index).toString();
                        const colors = ['10b981', '3b82f6', '8b5cf6', 'f59e0b', 'ef4444', '06b6d4', '84cc16', 'f97316'];
                        const randomColor = colors[Math.floor(Math.random() * colors.length)];
                        const url = `https://via.placeholder.com/150x150/${randomColor}/ffffff?text=${encodeURIComponent(file.name.substring(0, 8))}`;
                        
                        const fotoData = {
                            id,
                            url,
                            keterangan: files.length > 1 ? `${keterangan} (${index + 1})` : keterangan,
                            kategori,
                            tahun
                        };
                        
                        demoData.galeri.push(fotoData);
                    });
                    
                    loadGaleriData();
                    loadDashboardData();
                    showLoading(false);
                    
                    // Show success message
                    alert(`Berhasil mengupload ${files.length} foto!`);
                }, 1500);
            }

            document.getElementById('fotoModal').classList.add('hidden');
        }

        function deleteFoto(id) {
            if (confirm('Yakin ingin menghapus foto ini?')) {
                if (isDemo) {
                    demoData.galeri = demoData.galeri.filter(f => f.id !== id);
                    loadGaleriData();
                    loadDashboardData();
                }
            }
        }

        function addPemilikField() {
            const container = document.getElementById('pemilikList');
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'pemilik-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500 mb-2';
            input.placeholder = `Nama pemilik ${container.children.length + 1}`;
            container.appendChild(input);
        }

        function updatePemilikFields() {
            const jenis = document.getElementById('hewanJenis').value;
            const container = document.getElementById('pemilikList');
            
            if (jenis === 'sapi') {
                // Sapi needs 7 owners
                while (container.children.length < 7) {
                    addPemilikField();
                }
                document.getElementById('addPemilik').style.display = container.children.length >= 7 ? 'none' : 'block';
            } else {
                // Kambing needs 1 owner
                while (container.children.length > 1) {
                    container.removeChild(container.lastChild);
                }
                document.getElementById('addPemilik').style.display = 'none';
            }
        }

        function updateSapiOptions() {
            const jenis = document.getElementById('hewanJenis').value;
            const sapiContainer = document.getElementById('sapiTypeContainer');
            const sapiSelect = document.getElementById('sapiType');
            
            if (jenis === 'sapi') {
                sapiContainer.classList.remove('hidden');
                sapiSelect.required = true;
                
                // Generate sapi options and check availability
                sapiSelect.innerHTML = '<option value="">Pilih Sapi</option>';
                
                for (let i = 1; i <= 15; i++) {
                    const sapiName = `Sapi ${i}`;
                    const isOccupied = demoData.hewan.some(h => h.sapiType === sapiName && h.pemilik.length >= 7);
                    
                    const option = document.createElement('option');
                    option.value = sapiName;
                    option.textContent = sapiName + (isOccupied ? ' (Penuh)' : '');
                    option.disabled = isOccupied;
                    
                    if (isOccupied) {
                        option.style.color = '#9CA3AF';
                        option.style.fontStyle = 'italic';
                    }
                    
                    sapiSelect.appendChild(option);
                }
            } else {
                sapiContainer.classList.add('hidden');
                sapiSelect.required = false;
            }
        }

        function exportLaporan() {
            if (isDemo) {
                const data = {
                    panitia: demoData.panitia,
                    hewan: demoData.hewan,
                    mustahik: demoData.mustahik,
                    guru: demoData.guru,
                    tanggal: new Date().toLocaleDateString('id-ID')
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `laporan-qurban-mnf-${new Date().getFullYear()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        function clearForm(modalId) {
            const modal = document.getElementById(modalId);
            const form = modal.querySelector('form');
            form.reset();
            
            if (modalId === 'hewanModal') {
                const container = document.getElementById('pemilikList');
                while (container.children.length > 1) {
                    container.removeChild(container.lastChild);
                }
                document.getElementById('sapiTypeContainer').classList.add('hidden');
                document.getElementById('sapiType').required = false;
            }
            
            if (modalId === 'mustahikModal') {
                document.getElementById('mustahikModalTitle').textContent = 'Tambah Mustahik';
            }
        }

        // Delete functions (demo only)
        function deletePanitia(id) {
            if (confirm('Yakin ingin menghapus data panitia ini?')) {
                if (isDemo) {
                    demoData.panitia = demoData.panitia.filter(p => p.id !== id);
                    loadPanitiaData();
                    loadDashboardData();
                }
            }
        }

        function deleteHewan(id) {
            if (confirm('Yakin ingin menghapus data hewan ini?')) {
                if (isDemo) {
                    demoData.hewan = demoData.hewan.filter(h => h.id !== id);
                    loadHewanData();
                    loadDashboardData();
                }
            }
        }

        function deleteMustahik(id) {
            if (confirm('Yakin ingin menghapus data mustahik ini?')) {
                if (isDemo) {
                    demoData.mustahik = demoData.mustahik.filter(m => m.id !== id);
                    loadMustahikData();
                    loadDashboardData();
                }
            }
        }

        function deleteGuru(id) {
            if (confirm('Yakin ingin menghapus data ini?')) {
                if (isDemo) {
                    demoData.guru = demoData.guru.filter(g => g.id !== id);
                    loadGuruData();
                    loadDashboardData();
                }
            }
        }

        // Photo deletion removed - users can upload but not delete photos

        // Edit functions (simplified for demo)
        function editPanitia(id) {
            const panitia = demoData.panitia.find(p => p.id === id);
            if (panitia) {
                document.getElementById('panitiaNama').value = panitia.nama;
                document.getElementById('panitiaJabatan').value = panitia.jabatan;
                document.getElementById('panitiaHP').value = panitia.hp;
                document.getElementById('panitiaTahun').value = panitia.tahun;
                openModal('panitiaModal');
            }
        }

        function editHewan(id) {
            const hewan = demoData.hewan.find(h => h.id === id);
            if (hewan) {
                document.getElementById('hewanJenis').value = hewan.jenis;
                document.getElementById('hewanTahun').value = hewan.tahun;
                updatePemilikFields();
                updateSapiOptions();
                
                if (hewan.sapiType) {
                    document.getElementById('sapiType').value = hewan.sapiType;
                }
                
                const inputs = document.querySelectorAll('.pemilik-input');
                hewan.pemilik.forEach((nama, index) => {
                    if (inputs[index]) inputs[index].value = nama;
                });
                openModal('hewanModal');
            }
        }

        function editMustahik(id) {
            const mustahik = demoData.mustahik.find(m => m.id === id);
            if (mustahik) {
                document.getElementById('mustahikNama').value = mustahik.nama;
                document.getElementById('mustahikRT').value = mustahik.rt;
                document.getElementById('mustahikTahun').value = mustahik.tahun;
                document.getElementById('mustahikModalTitle').textContent = 'Edit Mustahik';
                openModal('mustahikModal');
            }
        }

        function editGuru(id) {
            const guru = demoData.guru.find(g => g.id === id);
            if (guru) {
                document.getElementById('guruNama').value = guru.nama;
                document.getElementById('guruKategori').value = guru.kategori;
                document.getElementById('guruTahun').value = guru.tahun;
                openModal('guruModal');
            }
        }

        function resetPanitiaFilters() {
            document.getElementById('filterPanitiaTahun').value = '';
            document.getElementById('searchPanitia').value = '';
            loadPanitiaData();
        }

        function resetHewanFilters() {
            document.getElementById('filterHewanTahun').value = '';
            document.getElementById('filterHewanJenis').value = '';
            document.getElementById('searchHewan').value = '';
            loadHewanData();
        }

        function resetMustahikFilters() {
            document.getElementById('filterMustahikTahun').value = '';
            document.getElementById('filterMustahikRT').value = '';
            document.getElementById('searchMustahik').value = '';
            loadMustahikData();
        }

        function resetGuruFilters() {
            document.getElementById('filterGuruTahun').value = '';
            document.getElementById('filterGuruKategori').value = '';
            document.getElementById('searchGuru').value = '';
            loadGuruData();
        }

        function resetGaleriFilters() {
            document.getElementById('filterGaleriTahun').value = '';
            document.getElementById('searchGaleri').value = '';
            loadGaleriData();
        }

        function viewPhoto(foto) {
            const modal = document.getElementById('photoViewModal');
            const image = document.getElementById('photoViewImage');
            const title = document.getElementById('photoViewTitle');
            const description = document.getElementById('photoViewDescription');
            const category = document.getElementById('photoViewCategory');
            const year = document.getElementById('photoViewYear');
            
            image.src = foto.url;
            image.alt = foto.keterangan;
            title.textContent = foto.keterangan;
            description.textContent = `Kategori: ${foto.kategori.charAt(0).toUpperCase() + foto.kategori.slice(1)}`;
            category.textContent = `📸 ${foto.kategori}`;
            year.textContent = `📅 ${foto.tahun}`;
            
            modal.classList.remove('hidden');
        }

        function generateYearOptions() {
            const currentYear = new Date().getFullYear();
            const currentHijriYear = currentYear - 579; // Approximate Hijri year calculation
            
            const yearSelectors = [
                'yearSelector',
                'filterPanitiaTahun', 
                'filterHewanTahun',
                'filterMustahikTahun',
                'filterGuruTahun',
                'filterGaleriTahun',
                'filterLaporanTahun',
                'panitiaTahun',
                'hewanTahun',
                'mustahikTahun',
                'guruTahun',
                'fotoTahun'
            ];
            
            yearSelectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                if (selector) {
                    // Clear existing options except "Semua Tahun" for filters
                    if (selectorId.includes('filter')) {
                        selector.innerHTML = '<option value="">Semua Tahun</option>';
                    } else {
                        selector.innerHTML = '';
                    }
                    
                    // Add current and previous years
                    for (let i = 0; i < 5; i++) {
                        const year = currentYear - i;
                        const hijriYear = currentHijriYear - i;
                        const option = document.createElement('option');
                        option.value = year.toString();
                        option.textContent = `${hijriYear}H / ${year}`;
                        
                        // Set current year as default for non-filter selectors
                        if (i === 0 && !selectorId.includes('filter')) {
                            option.selected = true;
                        }
                        
                        selector.appendChild(option);
                    }
                }
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'989c1bed90cfdf9f',t:'MTc1OTY1ODgxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
